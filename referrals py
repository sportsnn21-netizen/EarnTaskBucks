from aiogram import Router, types
from app.db.session import SessionLocal
from app.db.models import User
from app.bot.keyboards.menu import main_menu

router = Router()

@router.callback_query(lambda c: c.data=="my_referrals")
async def my_referrals(call: types.CallbackQuery):
    db = SessionLocal()
    user = db.query(User).filter(User.telegram_id==str(call.from_user.id)).first()
    referral_link = f"https://t.me/YourBot?start={user.id}"
    await call.message.answer(f"Your referral link: {referral_link}\nTotal referrals: {user.referrals_count}\nShare to earn more!")
    await call.message.answer("Use /menu to return.", reply_markup=main_menu())
    db.close()
